<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial IoT Predictive Maintenance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        .gauge-circle { fill: none; stroke: #e5e7eb; stroke-width: 8; }
        .gauge-progress { fill: none; stroke-width: 8; stroke-linecap: round; }
        .chart-band-normal { fill: #10B981; opacity: 0.3; }
        .chart-band-warning { fill: #F59E0B; opacity: 0.3; }
        .chart-band-danger { fill: #EF4444; opacity: 0.3; }
        .chart-line { fill: none; stroke-width: 2; stroke-linecap: round; }
        .chart-point { r: 4; }
        .sensor-card { transition: all 0.3s; }
        .parameter-chart { height: 300px; }
        .system-tab { transition: all 0.3s; }
        .system-tab.active { background: #3b82f6; color: white; }
        .nav-link { 
            padding: 8px 16px; 
            border-radius: 6px;
            transition: all 0.3s;
            font-weight: 500;
        }
        .nav-link:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        .nav-link.active {
            background: #3b82f6;
            color: white;
        }
        .threshold-line { stroke-width: 2; }
        .threshold-label { font-size: 10px; fill: #4b5563; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root">
        <div class="flex items-center justify-center min-h-screen">
            <div class="text-center">
                <div class="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"></div>
                <p class="mt-4 text-gray-600">Loading Dashboard...</p>
            </div>
        </div>
    </div>

<script>
// Enhanced configuration from Flask
const CONFIG = JSON.parse('{{ config | tojson | safe }}');
CONFIG.UTILS = {
    calculatePercentage: (value, min, max) => Math.min(100, Math.max(0, ((value - min) / (max - min)) * 100)),
    formatValue: (value, unit) => unit === 'rpm' ? `${Math.round(value)}${unit}` : `${value.toFixed(1)}${unit}`,
    formatTimestamp: (date) => new Date(date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' }),
    getStatusColor: (value, sensor) => 
        value < sensor.danger_low || value > sensor.danger_high ? '#EF4444' :
        value < sensor.warning_low || value > sensor.warning_high ? '#F59E0B' : '#10B981'
};

// Enhanced SingleParameterChart with better band visibility
function SingleParameterChart({ data, dataKey, sensor, height }) {
    const canvasRef = React.useRef(null);
    
    React.useEffect(() => {
        if (!canvasRef.current || !data.length) return;
        
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        height = canvas.height;
        const padding = 40;
        const chartHeight = height - padding * 2;
        const chartWidth = width - padding * 2;
        
        // Clear canvas
        ctx.clearRect(0, 0, width, height);
        
        // Draw bands with enhanced visibility
        const drawBand = (y1, y2, color) => {
            const yPos1 = height - padding - (y1 * chartHeight / sensor.danger_high);
            const yPos2 = height - padding - (y2 * chartHeight / sensor.danger_high);
            ctx.fillStyle = color;
            ctx.fillRect(padding, yPos2, chartWidth, yPos1 - yPos2);
        };
        
        // Danger bands
        drawBand(sensor.danger_low, sensor.warning_low, 'rgba(239, 68, 68, 0.25)');
        drawBand(sensor.warning_high, sensor.danger_high, 'rgba(239, 68, 68, 0.25)');
        
        // Warning bands
        drawBand(sensor.warning_low, sensor.min, 'rgba(245, 158, 11, 0.25)');
        drawBand(sensor.max, sensor.warning_high, 'rgba(245, 158, 11, 0.25)');
        
        // Normal band
        drawBand(sensor.min, sensor.max, 'rgba(16, 185, 129, 0.25)');
        
        // Draw grid
        ctx.strokeStyle = '#e5e7eb';
        ctx.lineWidth = 1;
        
        // Vertical grid
        for (let i = 0; i <= 10; i++) {
            const x = padding + (chartWidth / 10) * i;
            ctx.beginPath();
            ctx.moveTo(x, padding);
            ctx.lineTo(x, height - padding);
            ctx.stroke();
        }
        
        // Horizontal grid
        for (let i = 0; i <= 8; i++) {
            const y = padding + (chartHeight / 8) * i;
            ctx.beginPath();
            ctx.moveTo(padding, y);
            ctx.lineTo(width - padding, y);
            ctx.stroke();
        }
        
        // Draw threshold lines with labels (enhanced)
        const drawThreshold = (value, color, label) => {
            const y = height - padding - (value * chartHeight / sensor.danger_high);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            ctx.moveTo(padding, y);
            ctx.lineTo(width - padding, y);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Label with background
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillRect(width - padding - 100, y - 15, 100, 15);
            ctx.fillStyle = color;
            ctx.font = 'bold 10px Arial';
            ctx.fillText(`${label}: ${value}${sensor.unit}`, width - padding - 98, y - 3);
        };
        
        // Draw thresholds
        drawThreshold(sensor.min, '#10B981', 'Min');
        drawThreshold(sensor.max, '#10B981', 'Max');
        drawThreshold(sensor.warning_low, '#F59E0B', 'Warn Low');
        drawThreshold(sensor.warning_high, '#F59E0B', 'Warn High');
        drawThreshold(sensor.danger_low, '#EF4444', 'Danger Low');
        drawThreshold(sensor.danger_high, '#EF4444', 'Danger High');
        
        // Draw data line
        if (data.length > 1) {
            const maxVal = Math.max(...data.map(d => d[dataKey] || 0), sensor.danger_high);
            const minVal = Math.min(...data.map(d => d[dataKey] || 0), sensor.danger_low);
            
            ctx.strokeStyle = sensor.color;
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            
            data.forEach((point, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = height - padding - (point[dataKey] * chartHeight / sensor.danger_high);
                
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
                
                // Draw data point
                ctx.fillStyle = CONFIG.UTILS.getStatusColor(point[dataKey], sensor);
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            ctx.stroke();
        }
        
        // Draw Y-axis labels with better formatting
        ctx.fillStyle = '#4b5563';
        ctx.font = '10px Arial';
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        
        const valueRange = sensor.danger_high - sensor.danger_low;
        const steps = 5;
        for (let i = 0; i <= steps; i++) {
            const value = sensor.danger_low + (valueRange / steps) * i;
            const y = height - padding - (value * chartHeight / sensor.danger_high);
            ctx.fillText(`${value.toFixed(1)}${sensor.unit}`, padding - 5, y);
        }
        
        // Draw current value
        if (data.length > 0) {
            const latestValue = data[data.length - 1][dataKey];
            ctx.fillStyle = CONFIG.UTILS.getStatusColor(latestValue, sensor);
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Current: ${latestValue.toFixed(1)}${sensor.unit}`, padding, 20);
        }
        
    }, [data, dataKey, sensor, height]);
    
    return React.createElement('div', { className: 'relative bg-white p-4 rounded-lg shadow border border-gray-200' },
        React.createElement('h3', { className: 'text-lg font-semibold mb-2 text-gray-800 flex items-center' },
            React.createElement('span', { className: 'mr-2' }, sensor.icon),
            sensor.name
        ),
        React.createElement('canvas', {
            ref: canvasRef,
            width: 500,
            height: height || 320,
            className: 'w-full parameter-chart'
        })
    );
}

// Main Dashboard App
function DashboardApp() {
    const { useState, useEffect } = React;
    
    // State
    const [user, setUser] = useState(null);
    const [activeSystem, setActiveSystem] = useState('BUCKET_ELEVATOR');
    const [sensorData, setSensorData] = useState({
        BUCKET_ELEVATOR: [],
        CONVEYOR_BELT: []
    });
    const [alarms, setAlarms] = useState([]);
    const [connectionStatus, setConnectionStatus] = useState('simulation');
    const [activeSection, setActiveSection] = useState('dashboard');

    // Initialize
    useEffect(() => {
        fetch('/api/historical_data')
            .then(response => response.json())
            .then(data => {
                setSensorData(data);
            });
        
        const interval = setInterval(() => {
            if (user) {
                fetch('/api/current_data')
                    .then(response => response.json())
                    .then(data => {
                        setSensorData(prev => ({
                            BUCKET_ELEVATOR: [...prev.BUCKET_ELEVATOR.slice(-CONFIG.DASHBOARD.MAX_CHART_POINTS + 1), data.BUCKET_ELEVATOR],
                            CONVEYOR_BELT: [...prev.CONVEYOR_BELT.slice(-CONFIG.DASHBOARD.MAX_CHART_POINTS + 1), data.CONVEYOR_BELT]
                        }));
                        
                        // Check alarms
                        checkAlarms('BUCKET_ELEVATOR', data.BUCKET_ELEVATOR);
                        checkAlarms('CONVEYOR_BELT', data.CONVEYOR_BELT);
                    });
            }
        }, CONFIG.DASHBOARD.REFRESH_INTERVAL);

        return () => clearInterval(interval);
    }, [user]);

    const checkAlarms = (system, data) => {
        const newAlarms = [];
        const timestamp = new Date();
        const sensors = CONFIG.SYSTEMS[system].sensors;
        
        Object.entries(sensors).forEach(([key, sensor]) => {
            const sensorKey = key.toLowerCase();
            const value = data[sensorKey];
            
            if (value < sensor.danger_low || value > sensor.danger_high) {
                newAlarms.push({
                    id: Date.now() + Math.random(),
                    system: system,
                    sensor: sensorKey,
                    type: 'CRITICAL',
                    message: `${CONFIG.SYSTEMS[system].name} - ${sensor.name} out of range: ${value.toFixed(1)}${sensor.unit}`,
                    timestamp,
                    priority: 1,
                    acknowledged: false
                });
            } else if (value < sensor.warning_low || value > sensor.warning_high) {
                newAlarms.push({
                    id: Date.now() + Math.random(),
                    system: system,
                    sensor: sensorKey,
                    type: 'WARNING',
                    message: `${CONFIG.SYSTEMS[system].name} - ${sensor.name} approaching limits: ${value.toFixed(1)}${sensor.unit}`,
                    timestamp,
                    priority: 2,
                    acknowledged: false
                });
            }
        });

        if (newAlarms.length > 0) {
            setAlarms(prev => [...newAlarms, ...prev].slice(0, 50));
        }
    };

    // Sensor Gauge Component
    const SensorGauge = ({ sensor, value, title, unit, icon }) => {
        const percentage = CONFIG.UTILS.calculatePercentage(value, sensor.danger_low, sensor.danger_high);
        const isAlert = value < sensor.warning_low || value > sensor.warning_high;
        const isCritical = value < sensor.danger_low || value > sensor.danger_high;
        const circumference = 2 * Math.PI * 45;
        const strokeDasharray = `${(percentage / 100) * circumference} ${circumference}`;
        const statusColor = CONFIG.UTILS.getStatusColor(value, sensor);
        
        return React.createElement('div', { 
            className: `sensor-card p-4 rounded-lg shadow ${
                isCritical ? 'border-2 border-red-500' : 
                isAlert ? 'border-2 border-yellow-500' : 'border border-gray-200'
            }` 
        },
            React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                React.createElement('h3', { className: 'text-sm font-semibold text-gray-700 flex items-center' },
                    React.createElement('span', { className: 'mr-2 text-lg' }, icon),
                    title
                ),
                isCritical && React.createElement('span', { className: 'text-red-500 text-xl animate-pulse' }, 'ðŸš¨'),
                isAlert && !isCritical && React.createElement('span', { className: 'text-yellow-500 text-xl' }, 'âš ï¸')
            ),
            React.createElement('div', { className: 'flex items-center space-x-4' },
                React.createElement('div', { className: 'flex-1' },
                    React.createElement('div', { className: 'text-2xl font-bold text-gray-900 mb-1' }, 
                        CONFIG.UTILS.formatValue(value, unit)
                    ),
                    React.createElement('div', { className: 'text-xs text-gray-500' }, 
                        `Normal: ${sensor.min}-${sensor.max}${unit}`
                    ),
                    React.createElement('div', { 
                        className: `text-xs font-medium mt-2 px-2 py-1 rounded-full inline-block ${
                            isCritical ? 'bg-red-100 text-red-700' :
                            isAlert ? 'bg-yellow-100 text-yellow-700' :
                            'bg-green-100 text-green-700'
                        }`
                    }, isCritical ? 'Critical' : isAlert ? 'Warning' : 'Normal')
                ),
                React.createElement('div', { className: 'relative w-24 h-24' },
                    React.createElement('svg', { className: 'w-full h-full', viewBox: '0 0 100 100' },
                        React.createElement('circle', {
                            cx: '50', cy: '50', r: '45',
                            className: 'gauge-circle'
                        }),
                        React.createElement('circle', {
                            cx: '50', cy: '50', r: '45',
                            className: 'gauge-progress',
                            stroke: statusColor,
                            strokeDasharray: strokeDasharray,
                            strokeDashoffset: '0'
                        })
                    ),
                    React.createElement('div', { className: 'absolute inset-0 flex items-center justify-center' },
                        React.createElement('span', { className: 'text-lg font-bold', style: { color: statusColor } }, `${Math.round(percentage)}%`)
                    )
                )
            )
        );
    };

    // System Tabs
    const SystemTabs = () => (
        React.createElement('div', { className: 'flex space-x-2 mb-6' },
            Object.entries(CONFIG.SYSTEMS).map(([key, system]) => 
                React.createElement('button', {
                    key: key,
                    onClick: () => setActiveSystem(key),
                    className: `system-tab px-4 py-2 rounded-lg font-medium ${
                        activeSystem === key ? 'active' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`
                },
                    React.createElement('span', { className: 'mr-2' }, system.icon),
                    system.name
                )
            )
        )
    );

    // Navigation Component
    const NavigationBar = () => (
        React.createElement('div', { className: 'flex space-x-1 mb-2' },
            user.dashboardSections.includes('dashboard') &&
            React.createElement('button', {
                onClick: () => setActiveSection('dashboard'),
                className: `nav-link ${
                    activeSection === 'dashboard' ? 'active' : 'text-gray-600 hover:text-blue-600'
                }`
            }, 'Dashboard'),
            
            user.dashboardSections.includes('alarms') &&
            React.createElement('button', {
                onClick: () => setActiveSection('alarms'),
                className: `nav-link ${
                    activeSection === 'alarms' ? 'active' : 'text-gray-600 hover:text-blue-600'
                }`
            }, 'Alarms'),
            
            user.dashboardSections.includes('reports') &&
            React.createElement('button', {
                onClick: () => setActiveSection('reports'),
                className: `nav-link ${
                    activeSection === 'reports' ? 'active' : 'text-gray-600 hover:text-blue-600'
                }`
            }, 'Reports'),
            
            user.dashboardSections.includes('settings') &&
            React.createElement('button', {
                onClick: () => setActiveSection('settings'),
                className: `nav-link ${
                    activeSection === 'settings' ? 'active' : 'text-gray-600 hover:text-blue-600'
                }`
            }, 'System Configuration')
        )
    );

    // Login Form Component
    const LoginForm = () => {
        const [credentials, setCredentials] = useState({ username: '', password: '', role: 'operator' });
        const [loginLoading, setLoginLoading] = useState(false);
        
        const handleLogin = async (e) => {
            e.preventDefault();
            setLoginLoading(true);
            const roleConfig = CONFIG.ROLES[credentials.role] || CONFIG.ROLES.operator;
            setUser({
                name: roleConfig.name,
                role: credentials.role,
                permissions: roleConfig.permissions,
                dashboardSections: roleConfig.dashboardSections
            });
            setLoginLoading(false);
        };

        return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-600 via-purple-600 to-blue-800 flex items-center justify-center p-4' },
            React.createElement('div', { className: 'bg-white rounded-xl shadow-2xl p-8 w-full max-w-md' },
                React.createElement('div', { className: 'text-center mb-8' },
                    React.createElement('div', { className: 'mx-auto w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mb-4' },
                        React.createElement('span', { className: 'text-white text-2xl' }, 'âš¡')
                    ),
                    React.createElement('h1', { className: 'text-3xl font-bold text-gray-800 mb-2' }, CONFIG.DASHBOARD.TITLE),
                    React.createElement('p', { className: 'text-gray-600 font-medium' }, CONFIG.DASHBOARD.SUBTITLE),
                    React.createElement('p', { className: 'text-xs text-gray-500 mt-2' }, `Version ${CONFIG.DASHBOARD.VERSION}`)
                ),
                React.createElement('form', { onSubmit: handleLogin, className: 'space-y-6' },
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Username'),
                        React.createElement('input', {
                            type: 'text',
                            className: 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500',
                            value: credentials.username,
                            onChange: (e) => setCredentials({...credentials, username: e.target.value}),
                            placeholder: 'Enter your username',
                            required: true
                        })
                    ),
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Password'),
                        React.createElement('input', {
                            type: 'password',
                            className: 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500',
                            value: credentials.password,
                            onChange: (e) => setCredentials({...credentials, password: e.target.value}),
                            placeholder: 'Enter your password',
                            required: true
                        })
                    ),
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Role'),
                        React.createElement('select', {
                            className: 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500',
                            value: credentials.role,
                            onChange: (e) => setCredentials({...credentials, role: e.target.value})
                        },
                            Object.entries(CONFIG.ROLES).map(([key, role]) => 
                                React.createElement('option', { key: key, value: key }, role.name)
                            )
                        )
                    ),
                    React.createElement('button', {
                        type: 'submit',
                        disabled: loginLoading,
                        className: 'w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 font-medium'
                    }, loginLoading ? 'Signing In...' : 'Sign In')
                ),
                React.createElement('div', { className: 'mt-6 text-center' },
                    React.createElement('div', { 
                        className: `text-xs inline-flex items-center px-3 py-2 rounded-full ${
                            connectionStatus === 'connected' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                        }`
                    },
                        React.createElement('span', { className: 'w-2 h-2 rounded-full bg-current mr-2' }),
                        React.createElement('span', { className: 'font-medium' },
                            connectionStatus === 'connected' ? 'ðŸŸ¢ API Connected' : 'ðŸŸ¡ Demo Mode'
                        )
                    )
                )
            )
        );
    };

    // Placeholder components for new sections
    const AlarmsView = () => (
        React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow' },
            React.createElement('h2', { className: 'text-xl font-bold mb-4 text-gray-800' }, 'Alarms Management'),
            React.createElement('div', { className: 'overflow-x-auto' },
                React.createElement('table', { className: 'min-w-full divide-y divide-gray-200' },
                    React.createElement('thead', { className: 'bg-gray-50' },
                        React.createElement('tr', null,
                            React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'System'),
                            React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'Sensor'),
                            React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'Message'),
                            React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'Status'),
                            React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider' }, 'Timestamp')
                        )
                    ),
                    React.createElement('tbody', { className: 'bg-white divide-y divide-gray-200' },
                        alarms.slice(0, 5).map(alarm => 
                            React.createElement('tr', { key: alarm.id },
                                React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900' }, alarm.system),
                                React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap text-sm text-gray-500' }, alarm.sensor),
                                React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap text-sm text-gray-500' }, alarm.message),
                                React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap' },
                                    React.createElement('span', { 
                                        className: `px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                            alarm.type === 'CRITICAL' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'
                                        }`
                                    }, alarm.type)
                                ),
                                React.createElement('td', { className: 'px-6 py-4 whitespace-nowrap text-sm text-gray-500' }, alarm.timestamp.toLocaleTimeString())
                            )
                        )
                    )
                )
            )
        )
    );

    const ReportsView = () => (
        React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow' },
            React.createElement('h2', { className: 'text-xl font-bold mb-4 text-gray-800' }, 'Analytics Reports'),
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' },
                React.createElement('div', { className: 'bg-blue-50 p-6 rounded-lg border border-blue-100' },
                    React.createElement('h3', { className: 'text-lg font-semibold text-blue-800 mb-2' }, 'Performance Report'),
                    React.createElement('p', { className: 'text-blue-700 mb-4' }, 'System efficiency and throughput metrics over time'),
                    React.createElement('button', { className: 'bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700' }, 'View Report')
                ),
                React.createElement('div', { className: 'bg-green-50 p-6 rounded-lg border border-green-100' },
                    React.createElement('h3', { className: 'text-lg font-semibold text-green-800 mb-2' }, 'Maintenance Log'),
                    React.createElement('p', { className: 'text-green-700 mb-4' }, 'Historical maintenance activities and downtime records'),
                    React.createElement('button', { className: 'bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700' }, 'View Report')
                ),
                React.createElement('div', { className: 'bg-purple-50 p-6 rounded-lg border border-purple-100' },
                    React.createElement('h3', { className: 'text-lg font-semibold text-purple-800 mb-2' }, 'Anomaly Detection'),
                    React.createElement('p', { className: 'text-purple-700 mb-4' }, 'Pattern analysis of system anomalies and failures'),
                    React.createElement('button', { className: 'bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700' }, 'View Report')
                )
            )
        )
    );

    const SettingsView = () => (
        React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow' },
            React.createElement('h2', { className: 'text-xl font-bold mb-4 text-gray-800' }, 'System Configuration'),
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                React.createElement('div', { className: 'border border-gray-200 rounded-lg p-4' },
                    React.createElement('h3', { className: 'text-lg font-semibold text-gray-800 mb-4' }, 'Threshold Settings'),
                    React.createElement('div', { className: 'space-y-4' },
                        Object.entries(CONFIG.SYSTEMS[activeSystem].sensors).map(([key, sensor]) => 
                            React.createElement('div', { key: key, className: 'space-y-2' },
                                React.createElement('label', { className: 'block text-sm font-medium text-gray-700' }, sensor.name),
                                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'text-xs text-gray-500' }, 'Warning Low'),
                                        React.createElement('input', {
                                            type: 'number',
                                            className: 'w-full p-2 border border-gray-300 rounded',
                                            defaultValue: sensor.warning_low
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'text-xs text-gray-500' }, 'Warning High'),
                                        React.createElement('input', {
                                            type: 'number',
                                            className: 'w-full p-2 border border-gray-300 rounded',
                                            defaultValue: sensor.warning_high
                                        })
                                    )
                                ),
                                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'text-xs text-gray-500' }, 'Danger Low'),
                                        React.createElement('input', {
                                            type: 'number',
                                            className: 'w-full p-2 border border-gray-300 rounded',
                                            defaultValue: sensor.danger_low
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'text-xs text-gray-500' }, 'Danger High'),
                                        React.createElement('input', {
                                            type: 'number',
                                            className: 'w-full p-2 border border-gray-300 rounded',
                                            defaultValue: sensor.danger_high
                                        })
                                    )
                                )
                            )
                        )
                    )
                ),
                React.createElement('div', { className: 'border border-gray-200 rounded-lg p-4' },
                    React.createElement('h3', { className: 'text-lg font-semibold text-gray-800 mb-4' }, 'System Settings'),
                    React.createElement('div', { className: 'space-y-4' },
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Data Collection Interval'),
                            React.createElement('select', { className: 'w-full p-2 border border-gray-300 rounded' },
                                React.createElement('option', null, '5 seconds'),
                                React.createElement('option', null, '10 seconds'),
                                React.createElement('option', null, '30 seconds'),
                                React.createElement('option', null, '1 minute')
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Alert Notification Method'),
                            React.createElement('select', { className: 'w-full p-2 border border-gray-300 rounded' },
                                React.createElement('option', null, 'Email'),
                                React.createElement('option', null, 'SMS'),
                                React.createElement('option', null, 'Mobile App Push')
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Data Retention Period'),
                            React.createElement('select', { className: 'w-full p-2 border border-gray-300 rounded' },
                                React.createElement('option', null, '30 days'),
                                React.createElement('option', null, '90 days'),
                                React.createElement('option', null, '1 year')
                            )
                        )
                    )
                )
            ),
            React.createElement('div', { className: 'mt-6 flex justify-end space-x-3' },
                React.createElement('button', { className: 'px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50' }, 'Cancel'),
                React.createElement('button', { className: 'px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700' }, 'Save Configuration')
            )
        )
    );

    // Dashboard View Component
    const DashboardView = () => {
        const system = CONFIG.SYSTEMS[activeSystem];
        const data = sensorData[activeSystem] || [];
        const latestData = data.length > 0 ? data[data.length - 1] : {};
        
        return React.createElement('div', { className: 'space-y-6' },
            React.createElement('div', { className: 'flex justify-between items-center' },
                React.createElement('h1', { className: 'text-2xl font-bold text-gray-900' }, 'Real-Time Monitoring'),
                React.createElement('div', { className: 'flex items-center space-x-4' },
                    React.createElement('span', { 
                        className: `inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${
                            connectionStatus === 'connected' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                        }`
                    },
                        React.createElement('span', { className: 'w-2 h-2 rounded-full bg-current mr-2' }),
                        connectionStatus === 'connected' ? 'System Online' : 'Demo Mode'
                    ),
                    React.createElement('span', { className: 'text-sm text-gray-600 font-medium' },
                        `Last Update: ${new Date().toLocaleTimeString()}`
                    )
                )
            ),
            
            React.createElement(SystemTabs),
            
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4' },
                Object.entries(system.sensors).map(([key, sensor]) => {
                    const sensorKey = key.toLowerCase();
                    const value = latestData[sensorKey] || 0;
                    
                    return React.createElement(SensorGauge, {
                        key: key,
                        sensor: sensor,
                        value: value,
                        title: sensor.name,
                        unit: sensor.unit,
                        icon: sensor.icon
                    });
                })
            ),
            
            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                Object.entries(system.sensors).map(([key, sensor]) => {
                    const sensorKey = key.toLowerCase();
                    return React.createElement(SingleParameterChart, {
                        key: key,
                        data: data,
                        dataKey: sensorKey,
                        sensor: sensor,
                        height: 320
                    });
                })
            )
        );
    };

    // Main App Render Logic
    if (!user) {
        return React.createElement(LoginForm);
    }

    return React.createElement('div', { className: 'flex flex-col min-h-screen bg-gray-100' },
        React.createElement('header', { className: 'bg-white shadow-sm border-b border-gray-200' },
            React.createElement('div', { className: 'flex items-center justify-between px-6 py-4' },
                React.createElement('div', { className: 'flex items-center space-x-4' },
                    React.createElement('h2', { className: 'text-xl font-bold text-gray-800' }, 'Industrial IoT Dashboard')
                ),
                React.createElement('div', { className: 'flex items-center space-x-4' },
                    React.createElement('div', { className: 'flex items-center space-x-3 bg-gray-50 rounded-lg px-4 py-2' },
                        React.createElement('div', null,
                            React.createElement('span', { className: 'text-sm font-semibold text-gray-700 block' }, user.name),
                            React.createElement('span', { 
                                className: 'text-xs px-2 py-1 rounded-full font-medium',
                                style: { 
                                    backgroundColor: CONFIG.ROLES[user.role].color + '20', 
                                    color: CONFIG.ROLES[user.role].color
                                }
                            }, user.role.toUpperCase())
                        )
                    ),
                    React.createElement('button', {
                        onClick: () => setUser(null),
                        className: 'text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100',
                        title: 'Logout'
                    }, React.createElement('span', { className: 'text-xl' }, 'ðŸšª'))
                )
            ),
            React.createElement('div', { className: 'px-6 pb-2' },
                React.createElement(NavigationBar)
            )
        ),
        React.createElement('main', { className: 'flex-1 p-6' },
            activeSection === 'dashboard' ? React.createElement(DashboardView) :
            activeSection === 'alarms' ? React.createElement(AlarmsView) :
            activeSection === 'reports' ? React.createElement(ReportsView) :
            activeSection === 'settings' ? React.createElement(SettingsView) :
            React.createElement(DashboardView)
        ),
        React.createElement('footer', { className: 'bg-gray-800 text-gray-300 py-4 px-6 text-center text-sm' },
            'Industrial IoT Predictive Maintenance System v3.0 | Â© 2025 SmartFactory Solutions '
        )
    );
}

// Initialize the app
ReactDOM.render(React.createElement(DashboardApp), document.getElementById('root'));
</script>
</body>
</html>